<!DOCTYPE HTML PUBLIC -//W3C//DTD HTML 4.01 Transitional//EN>

<HTML>
  <HEAD>
    <TITLE>Open issues about UML diagrams</TITLE>
  </HEAD>
  <BODY>
  <H1>Open issues in UML diagrams</H1>
  <P ALIGN="justify">The following are <A HREF="http://geoapi.sourceforge.net">GeoAPI</A> comments
  (not <A HREF="http://www.opengis.org">OGC</A> comments). Those observations were collected during
  the process of hand-editing the Java interfaces that were created automatically from the UML by a
  script. In the following discussion, "specification 2003-73" refers to the <EM>abstract</EM>
  specification <A HREF="http://www.opengis.org/docs/03-073r1.zip">Spatial Referencing by Coordinates
  (Topic 2)</A>, while "specification 2001-009" refers to the <EM>implementation</EM> specification
  <A HREF="http://www.opengis.org/docs/01-009.pdf">Coordinate Transformation Services</A>. The
  later was based on a older abstract specification.
  </P>
  <P>&nbsp;</P>
  <UL>
    <LI><P ALIGN="justify">There is no standard parameter names and no "<CITE>Well Know Text</CITE>"
        (WKT) format in the 2003-073 specification. Standard parameter names and format were proposed
        in the 2001-009 specification (e.g. "<CODE>semi_major</CODE>", "<CODE>semi_minor</CODE>",
        "<CODE>standard_parallel_1</CODE>", <I>etc.</I>). Some developers have already accepted
        those names as "standard". For example, OGC parameter names are listed on the
        <A HREF="http://www.remotesensing.org/geotiff/proj_list/">remotesensing.org</A> web site.</P>

        <TABLE cellpadding='0' cellspacing='0'><TR VALIGN="top"><TD><STRONG>PROPOSAL:&nbsp;</STRONG></TD><TD>
        <P ALIGN="justify"><FONT COLOR="red"><CITE>Well Know Text</CITE>
        format and parameter names from the legacy 2001-009 specification should be ported to the
        2003-073 specification. They are <U>proposed</U> standards; we recognize that different vendors
        already use different sets of parameter names.</FONT></P></TD></TR></TABLE>
    </LI>

    <LI><P ALIGN="justify">No exception are defined in case of failure (for example if a map projection
        fails to converge because the coordinate point is outside the valid area).</P>

        <TABLE cellpadding='0' cellspacing='0'><TR VALIGN="top"><TD><STRONG>PROPOSAL:&nbsp;</STRONG></TD><TD>
        <P ALIGN="justify"><FONT COLOR="red">The specification should
        defines some minimal set of exceptions (e.g. <CODE>ConversionException</CODE>,
        <CODE>MapProjectionException</CODE>, <CODE>IllegalCoordinateSystemException</CODE>,
        <I>etc.</I>).</FONT></P></TD></TR></TABLE>
    </LI>

    <LI><P ALIGN="justify">There is no localization support in all specifications I have read up to date.
        Localization is an European Union requirement. Some country like Canada requires bilingual software
        in their administrations. However, not all <CODE>CharacterString</CODE> should be localizable; for
        example <CITE>Well Know Text</CITE> or code name should probably be language neutral. The way to
        localize a character string is profile-dependent, but the UMLs should at least specify which
        <CODE>CharacterString</CODE> are localizable and which ones are not.</P>

        <TABLE cellpadding='0' cellspacing='0'><TR VALIGN="top"><TD><STRONG>PROPOSAL:&nbsp;</STRONG></TD><TD>
        <P ALIGN="justify"><FONT COLOR="red">Add a new stereotype in UML:
        <CODE>LocalizableCharacterString</CODE>. Update all UML accordingly. Only
        <CODE>LocalizableCharacterString</CODE> can be localized. The localization is performed in
        a profile-dependent way.</FONT></P></TD></TR></TABLE>
    </LI>

    <LI><P ALIGN="justify">The <A HREF="../crs/crs/ImageCRS.html"><CODE>ImageCRS</CODE></A> interface is defined as a kind
        of engineering CRS, but doesn't extend <A HREF="../crs/crs/EngineeringCRS.html"><CODE>EngineeringCRS</CODE></A>.
        Maybe it should (there is no obvious technical reason preventing that).</P>

        <TABLE cellpadding='0' cellspacing='0'><TR VALIGN="top"><TD><STRONG>PROPOSAL:&nbsp;</STRONG></TD><TD>
        <P ALIGN="justify"><FONT COLOR="red">Move (in the hierarchy)
        <A HREF="../crs/crs/ImageCRS.html"><CODE>ImageCRS</CODE></A> as a sub-interface of
        <A HREF="../crs/crs/EngineeringCRS.html"><CODE>EngineeringCRS</CODE></A>.</FONT></P></TD></TR></TABLE>
    </LI>

    <LI><P ALIGN="justify">"<CODE>operationMethod</CODE>" attribute is defined in
        <A HREF="../crs/operation/CoordinateOperation.html"><CODE>CoordinateOperation</CODE></A>, but applied only to
        <A HREF="../crs/operation/Transformation.html"><CODE>Transformation</CODE></A> (a sub-interface). Maybe
        it should be defined only in <CODE>Transformation</CODE> interface.</P>

        <TABLE cellpadding='0' cellspacing='0'><TR VALIGN="top"><TD><STRONG>PROPOSAL:&nbsp;</STRONG></TD><TD>
        <P ALIGN="justify"><FONT COLOR="red">Move down (in the hierarchy)
        the "<CODE>operationMethod</CODE>" attribute into the
        <A HREF="../crs/operation/Transformation.html"><CODE>Transformation</CODE></A> sub-interface.</FONT></P></TD></TR></TABLE>
    </LI>

    <LI><P ALIGN="justify"><A HREF="../spatialschema/geometry/complex/CompositeCurve.html"><CODE>CompositeCurve</CODE></A>
            extends (indirectly) both <CODE>Primitive</CODE> and <CODE>Complex</CODE>. Consequently,
            there is a clash in the semantics of some set theoretic operation. Specifically,
            <code>Primitive.contains(...)</code> (returns FALSE for end points) is different
            from <code>Complex.contains(...)</code> (returns TRUE for end points).</P></LI>

        <TABLE cellpadding='0' cellspacing='0'><TR VALIGN="top"><TD><STRONG>PROPOSAL:&nbsp;</STRONG></TD><TD>
        <P ALIGN="justify"><FONT COLOR="red">(none at this stage).</FONT></P></TD></TR></TABLE>
  </UL>




  <P>&nbsp;</P>
  <P>&nbsp;</P>
  <HR>
  <P>&nbsp;</P>
  <H1><A NAME="Changes">Differences between abstract specifications and GeoAPI</A></H1>
  <H2>Changes in Spatial Referencing by Coordinates</H2>
  <UL>
    <LI><P ALIGN="justify">Factory and operations from the legacy 2001-009 specification have been
        ported to the 2003-073 specification. This is because UML diagrams found in the 2003-073
        specification contains only <EM>attributes</EM> or <EM>associations</EM>, no <EM>operations</EM>.
        Many services found in the legacy 2001-009 specification are not available in latest UML.
        More specifically:</P>
        <P><UL>
          <LI>There was nothing like a transformation method taking a point or an array
          in argument and returning a transformed point or array (e.g. the legacy
          <A HREF=../../../../legacy/org/opengis/ct/CT_MathTransform.html><CODE>CT_MathTransform</CODE></A>
          interface).</LI>

          <LI>There was no factory at all (e.g. the legacy
          <A HREF=../../../../legacy/org/opengis/ct/CT_CoordinateTransformationFactory.html><CODE>CT_CoordinateTransformationFactory</CODE></A>
          interface).</LI>
        </UL></P>
    </LI>

    <LI><P ALIGN="justify">Dropped the <CODE>CRS</CODE> interface. This has the side effect of
        allowing <A HREF="../crs/crs/CompoundCRS.html"><CODE>CompoundCRS</CODE></A> to contains
        other <CODE>CompoundCRS</CODE>. An other side effect is to resolves some misleading attribute
        or association name. For example "<CODE>includesCRS</CODE>" in
        <A HREF="../crs/crs/CompoundCRS.html"><CODE>CompoundCRS</CODE></A> is of type
        <A HREF="../crs/crs/CoordinateReferenceSystem.html"><CODE>CoordinateReferenceSystem</CODE></A>,
        not <CODE>CRS</CODE>.

        This fix was done because the <CODE>CRS</CODE> interface stands between
        <A HREF="../crs/ReferenceSystem.html"><CODE>ReferenceSystem</CODE></A> and
        <A HREF="../crs/crs/CoordinateReferenceSystem.html"><CODE>CoordinateReferenceSystem</CODE></A>
        and looks like an anomaly in an otherwise quite natural hierarchy
        (<code>CoordinateReferenceSystem extends ReferenceSystem</code>).
        "<code>CRS</code>" is just an abbreviation for "<code>CoordinateReferenceSystem</code>";
        its name doesn't give any clue about the difference between those two interfaces.
        Furthermore, the main "raison d'être" for <code>CRS</code> seems to be related to the
        <A HREF="../crs/crs/CompoundCRS.html"><CODE>CompoundCRS</CODE></A>'s contract ("<cite>A Compound
        CRS is a coordinate reference system that combines two or more coordinate reference systems, <U>none
        of which can itself be compound</U></cite>" - emphasis is mine). This contract is enforced
        by the hierarchy (<code>CompoundCRS</code> is the only "<code>FooCRS</code>" interface that
        extends directly <code>CRS</code>) and by the <code>getCoordinateReferenceSystem</code>
        return type. But I question it for the following reasons:</P>
        <ul>
         <li><P ALIGN="justify">In "<u>Coordinate Transformation Services</u>" (OGC document
              01-009), compound CRS was specified as a pair of arbitrary CRS ("head" and "tail").
              Each of them can be an other compound CRS, allowing the creation of a tree.
              This design was convenient to use (see next points below) and avoid a special
              hierarchy for compound CRS; it is just like any other CRS.</P></li>

          <li><P ALIGN="justify">It is convenient to use <code>CompoundCRS</code> as building
              block for more complex <code>CompoundCRS</code>, and get back the original one
              later. For example a user could creates the following:</P>
              <pre>
                  CRS  vertical = new VerticalCRS(...);
                  CRS  temporal = new TemporalCRS(...);
                  CRS  cs2D = new GeographicCRS(...);
                  CRS  cs3D = new CompoundCRS(cs2D, vertical);
                  CRS  cs4D = new CompoundCRS(cs3D, temporal);
              </pre>
              <P ALIGN="justify">Then, at some later stage, breaks <code>cs4D</code> in its two
              components (<code>headCS</code> and <code>tailCS</code> in OGC 01-009's terminology)
              and compares the head CRS with <code>cs3D</code>. The user may wants to do
              that because its own code may have some special hooks for <code>cs3D</code>,
              since he has built this CRS himself. With the current <code>CompoundCRS</code>
              speficiation, this approach is not possible since <code>getCoordinateReferenceSystem</code>
              allow only a flat view of component's CRS; any user custom <code>CompoundCRS</code>
              (and all remarks, identifiers and other useful informations) are lost.</P></li>
        </ul>
        <P ALIGN="justify">A remaining issue is to define the semantic of <code>getCoordinateSystem()</code>
        and <code>getDatum()</code> methods for <A HREF="../crs/crs/CompoundCRS.html"><CODE>CompoundCRS</CODE></A>.
        Various proposal may be considered:</P>
        <p><ul>
          <li>they may return <code>null</code>;</li>
          <li>they may throw an <code>UnsupportedOperationException</code>;</li>
          <li>they may return a special implementation of <code>CoordinateSystem</code>
              and <code>Datum</code>, which don't need to be public: the
              <code>CompoundCRS</code> implementation can generate them as needed.
              Note that this behaviour may actually be quite useful. For example,
              a <code>CompoundCRS</code> made of a <code>GeographicCRS</code> with
              a <code>VerticalCRS</code> have a 3-D <code>EllipsoidalCS</code>.</li>
        </ul></p>
    </LI>

    <LI><P ALIGN="justify">Moved (in the hierarchy)
        <A HREF="../crs/cs/CartesianCS.html"><CODE>CartesianCS</CODE></A> as a sub-interface of
        <A HREF="../crs/cs/ObliqueCartesianCS.html"><CODE>ObliqueCartesianCS</CODE></A>. This is
        because the interface <A HREF="../crs/cs/CartesianCS.html"><CODE>CartesianCS</CODE></A>
        looks like a special case of <A HREF="../crs/cs/ObliqueCartesianCS.html"><CODE>ObliqueCartesianCS</CODE></A>.
        This is a similar argument than the one used in ISO-19107, which said that <code>Circle</code> is a sub-class
        of <code>Ellipse</code> since the former is a special case of the later (see 5.1.5 <cite>Strong substitutability</cite>).
        Doing so help to clarify the semantic of <A HREF="../crs/crs/ImageCRS.html"><CODE>ImageCRS</CODE></A>:
        We dropped "<CODE>cartesianCS</CODE>" and "<CODE>obliqueCartesianCS</CODE>" attributes and
        replaced them by a restriction on the "<CODE>usesCS</CODE>" association, exactly like what
        is done in <A HREF="../crs/crs/ProjectedCRS.html"><CODE>ProjectedCRS</CODE></A>.</P>
    </LI>

    <LI><P ALIGN="justify">Dropped all classname prefix in "<code>name</code>" and "<code>ID</code>"
        attributes. Moved "<code>name</code>", "<code>ID</code>" and "<code>remarks</code>" attributes
        in a common super-interface,
        <A HREF="../crs/Info.html"><CODE>Info</CODE></A>, which is set as the parent of the following interfaces:
        <A HREF="../crs/ReferenceSystem.html"><CODE>ReferenceSystem</CODE></A>,
        <A HREF="../crs/cs/CoordinateSystem.html"><CODE>CoordinateSystem</CODE></A>,
        <A HREF="../crs/cs/CoordinateSystemAxis.html"><CODE>CoordinateSystemAxis</CODE></A>,
        <A HREF="../crs/datum/Datum.html"><CODE>Datum</CODE></A>,
        <A HREF="../crs/datum/PrimeMeridian.html"><CODE>PrimeMeridian</CODE></A>,
        <A HREF="../crs/datum/Ellipsoid.html"><CODE>Ellipsoid</CODE></A>,
        <A HREF="../crs/operation/CoordinateOperation.html"><CODE>CoordinateOperation</CODE></A>,
        <A HREF="../crs/operation/OperationMethod.html"><CODE>OperationMethod</CODE></A>,
        <A HREF="../parameter/GeneralOperationParameter.html"><CODE>GeneralOperationParameter</CODE></A>.
        This interface defines the <CODE>getName</CODE>, <CODE>getIdentifiers</CODE> and
        <CODE>getRemarks</CODE> methods, which are common to all above-cited interfaces.
        This <CODE>Info</CODE> root interface is similar to the legacy
        <A HREF=../../../../legacy/org/opengis/cs/CS_Info.html><CODE>CS_Info</CODE></A>
        interface from the implementation specification 1.0. In the 2003-073 specification, the name
        and identifier attributes were duplicated in many interfaces, with different identifier name
        (e.g. "<CODE>ellipsoidName</CODE>", "<CODE>datumName</CODE>", "<CODE>csName</CODE>",
        "<CODE>crsName</CODE>", etc.).</P>
    </LI>

    <LI><P ALIGN="justify">Union structures avoided. While it is possible to mimic C's <CODE>union</CODE>
        in Java, the hacks are usually unconvenient. Furthermore, <CODE>union</CODE> are not type-safe even
        in C. Consequently, the following structures were omitted:
        <CODE>CD_SecondDefiningParameter</CODE> (replaced by an API similar to the legacy
        <A HREF=../../../../legacy/org/opengis/cs/CS_Ellipsoid.html><CODE>CS_Ellipsoid</CODE></A>).</P>
    </LI>

    <LI><P ALIGN="justify">Added a
        <A HREF="../crs/operation/Projection.html"><CODE>Projection</CODE></A> interface as a special kind of
        <A HREF="../crs/operation/Conversion.html"><CODE>Conversion</CODE></A>. Subinterfaces of
        <CODE>Projection</CODE> make it possible to check which kind of projection is applied
        (planar, cylindrical, conical...).</P>
    </LI>

    <LI><P ALIGN="justify">Added a
        <A HREF="../crs/operation/Matrix.html"><CODE>Matrix</CODE></A> interface as the parent of
        <A HREF="../crs/quality/CovarianceMatrix.html"><CODE>CovarianceMatrix</CODE></A>.
        The legacy 2001-09 specification defined a
        <A HREF=../../../../legacy/org/opengis/pt/PT_Matrix.html><CODE>PT_Matrix</CODE></A>
        interface, which is required for derivative computation. The 2003-073 specification
        defined only <A HREF="../crs/quality/CovarianceMatrix.html"><CODE>CovarianceMatrix</CODE></A>,
        which is too restrictive.</P>
    </LI>

    <LI><P ALIGN="justify">Added <A HREF="../crs/cs/AxisDirection.html"><CODE>AxisDirection</CODE></A>
        code list. It is actually an anticipation on future work planed by the specification team.
        The <A HREF="../crs/cs/CoordinateSystemAxis.html#getDirection()"><code>getDirection()</code></A>
        return type was adjusted accordingly. Note that the legacy 2001-09 specification defined a
        <A HREF=../../../../legacy/org/opengis/cs/CS_AxisOrientationEnum><CODE>CS_AxisOrientationEnum</CODE></A>
        where the 2003-073 specification just used a plain character string.</P>
    </LI>

    <LI><P ALIGN="justify">Added the following methods into
        <A HREF="../crs/cs/AxisDirection.html"><CODE>AxisDirection</CODE></A>:
        <CODE>inverse()</CODE> and <CODE>absolute()</CODE>.</P>
    </LI>

    <LI><P ALIGN="justify">Renamed <CODE>ParameterValueGroup.getGroup()</CODE> method as
         <A HREF="../parameter/ParameterValueGroup.html#getDescriptor()"><CODE>getDescriptor()</CODE></A>
         and moved it in the hierarchy up into
         <A HREF="../parameter/GeneralParameterValue.html#getDescriptor()"><CODE>GeneralParameterValue</CODE></A>.
         The <CODE>getDescriptor()</CODE> name was choosen because <CODE>getGroup()</CODE> seems too
         restrictive, misleading (it returns an abstract definition of a group of parameters, not the
         actual group), and for consistency with usage in other Java extensions (e.g. JAI's
         <A HREF="http://java.sun.com/products/java-media/jai/forDevelopers/jai-apidocs/javax/media/jai/ParameterList.html#getParameterListDescriptor()"><CODE>ParameterList</CODE></A>).</P></LI>

    <LI><P ALIGN="justify">Moved the
        <A HREF="../parameter/GeneralOperationParameter.html">     <code>GeneralOperationParameter</code></A>,
        <A HREF="../parameter/OperationParameter.html">            <code>OperationParameter</code></A>,
        <A HREF="../parameter/OperationParameterGroup.html">       <code>OperationParameterGroup</code></A>,
        <A HREF="../parameter/GeneralParameterValue.html">         <code>GeneralParameterValue</code></A>,
        <A HREF="../parameter/ParameterValue.html">                <code>ParameterValue</code></A>,
        <A HREF="../parameter/ParameterValueGroup.html">           <code>ParameterValueGroup</code></A>,
        <A HREF="../parameter/InvalidParameterNameException.html"> <code>InvalidParameterNameException</code></A>,
        <A HREF="../parameter/InvalidParameterTypeException.html"> <code>InvalidParameterTypeException</code></A> and
        <A HREF="../parameter/InvalidParameterValueException.html"><code>InvalidParameterValueException</code></A>
        interfaces from <code>org.opengis.referencing.operation</code> to <code>org.opengis.parameter</code>
        since it is of use for grid coverages as well as operations. The goal is to avoid a
        duplicated API for parameters in coordinate operations and grid coverage operations.</P>

    <LI><P ALIGN="justify">Moved up (in the hierarchy) the "<CODE>maximumOccurs</CODE>" attribute from
        <A HREF="../parameter/OperationParameterGroup.html"><CODE>OperationParameterGroup</CODE></A> into the
        <A HREF="../parameter/GeneralOperationParameter.html"><CODE>GeneralOperationParameter</CODE></A>
        super-interface, in order to be on per with the "<CODE>minimumOccurs</CODE>" attribute.</P></LI>

    <LI><P ALIGN="justify">Removed the <CODE>DerivedCRSType</CODE> code list, since a Java
        expression like <CODE>(baseCRS instanceof FooCRS)</CODE> provides the same capability
        with more flexibility.</P></LI>
  </UL>



  <P>&nbsp;</P>
  <H2>Changes in Feature Geometry</H2>
  <UL>
    <LI><P ALIGN="justify">Renamed <CODE>GM_Object</CODE> as
        <A HREF="../spatialschema/geometry/Geometry.html"><CODE>Geometry</CODE></A>
        in order to avoid ambiguity with <CODE>java.lang.Object</CODE>.</P></LI>

    <LI><P ALIGN="justify">Moved <A HREF="../spatialschema/geometry/Envelope.html"><CODE>Envelope</CODE></A>
        and <A HREF="../spatialschema/geometry/DirectPosition.html"><CODE>DirectPosition</CODE></A>
        in the root geometry package (<CODE>org.opengis.spatialschema.geometry</CODE>) since they are
        used in many places in most packages.</P></LI>
  </UL>


  <P>&nbsp;</P>
  <H2>Changes in Grid Coverages</H2>
  <UL>
    <LI><P ALIGN="justify">In <A HREF="../coverage/Coverage.html"><CODE>Coverage</CODE></A>, changed
        <CODE>evaluateAsDouble(DirectPosition)</CODE> into <CODE>evaluate(DirectPosition, double[])</CODE>
        for reusing optionally pre-allocated array. This is consistent with Java usage in <CODE>Raster</CODE>
        for example. Same apply to all <CODE>evaluateAsFoo(DirectPosition)</CODE> methods.</P></LI>

    <LI><P ALIGN="justify">In <A HREF="../coverage/grid/GridCoverage.html"><CODE>GridCoverage</CODE></A>, changed
        <CODE>getDataBlockAsDouble(GridRange)</CODE> into <CODE>getDataBlock(GridCoverage, double[])</CODE>
        for reusing optionally pre-allocated array. This is consistent with Java usage in <CODE>Raster</CODE>
        for example. Same apply to all <CODE>getDataBlockAsFoo(GridRange)</CODE> methods.</P></LI>

    <LI><P ALIGN="justify">Return type of
        <A HREF="../coverage/Coverage.html#getSource(int)"><CODE>Coverage.getSource(int)</CODE></A>
        was relaxed from <CODE>GridCoverage</CODE> to <CODE>Coverage</CODE>. Instead, the return
        type has been constrained to <CODE>GridCoverage</CODE> only in
        <A HREF="../coverage/grid/GridCoverage.html#getSource(int)"><CODE>GridCoverage.getSource(int)</CODE></A>.
        This approach (return type covariance) was already used in "Spatial Referencing by
        Coordinates" (ISO 19111). It avoid forward dependency of <CODE>Coverage</CODE> toward
        <CODE>GridCoverage</CODE> and give more flexibility for use of <CODE>Coverage</CODE>
        with non-gridded data.</P></LI>

    <LI><P ALIGN="justify">In <CODE>Coverage</CODE>, added an optional
        <A HREF="../coverage/Coverage.html#getRenderableImage(int, int)"><CODE>getRenderableImage</CODE></A>
        method for interoperability with Java2D.</P></LI>

    <LI><P ALIGN="justify">In <CODE>SampleDimension</CODE>, added an optional
        <A HREF="../coverage/SampleDimension.html#getSampleToGeophysics()"><CODE>getSampleToGeophysics</CODE></A>
        method as a generalization of <code>scale</code> and <code>offset</code> attributes.</P></LI>

    <LI><P ALIGN="justify">Exceptions
        <A HREF="../coverage/MetadataNameNotFoundException.html"><CODE>MetadataNameNotFoundException</CODE></A>
        were declared only once in the CV package, not duplicated in every packages.</P></LI>

    <LI><P ALIGN="justify">Omitted
        <CODE>InvalidIndexException</CODE> (replaced by <CODE>IndexOutOfBoundsException</CODE>) and
        <CODE>ErrorExportingGridCoverageException</CODE> (replaced by <CODE>IOException</CODE>).</P></LI>

    <LI><P ALIGN="justify">Added
        <A HREF="../coverage/CannotEvaluateException.html"><CODE>CannotEvaluateException</CODE></A> as a super-class of
        <A HREF="../coverage/PointOutsideCoverageException.html"><CODE>PointOutsideCoverageException</CODE></A>.</P></LI>
  </UL>
  </BODY>
</HTML>
